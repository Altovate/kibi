<kbn-settings-app section="relations">
  <div ng-controller="RelationsController" class="app-container container relations" id="relations">

    <div class="header">
      <h2 class="title">Relations in Kibi</h2>
    </div>
    <p>
      Use this to configure the relations.
    </p>

    <div class="config-section">
      <h2>Config</h2>

      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="relationalPanel"/> Enable relational panel
        </label>
      </div>

      <ul class="nav nav-tabs">
        <li ng-class="{ active: state.tab === 'indices' }" class="kbn-settings-tab">
          <a title="Relations between Index Patterns" ng-click="changeTab('indices')">Relations between Index Patterns</a>
        </li>
        <li ng-class="{ active: state.tab === 'dashboards' }" class="kbn-settings-tab">
          <a title="Relations between Dashboards" ng-click="changeTab('dashboards')">Relations between Dashboards</a>
        </li>
      </ul>
      <div class="tab-content">
        <form name="indicesForm" ng-class="{ active: state.tab === 'indices' }" class="tab-pane" novalidate>
          <div class="form-group table-responsive">
            <table class="table table-condensed">
              <thead>
                <tr>
                  <th>Left Index Pattern</th>
                  <th>Left Field</th>
                  <th></th>
                  <th>Right Index Pattern</th>
                  <th>Right Field</th>
                  <th>Label</th>
                  <th></th>
                </tr>
              </thead>
              <tbody ng-repeat="relation in relations.relationsIndices">
                <tr class="relation-row" ng-class="{ 'red-border' : !!relation.error }">
                  <td>
                    <st-select required object-type="indexPattern" ng-model="relation.indices[0].indexPatternId">
                  </td>
                  <td>
                    <st-select required object-type="field" analyzed-warning="true"
                               index-pattern-id="relation.indices[0].indexPatternId"
                               ng-model="relation.indices[0].path"/>
                  </td>
                  <td>
                    <i aria-hidden="true" class="fa fa-arrows-h"></i>
                  </td>
                  <td>
                    <st-select required object-type="indexPattern" ng-model="relation.indices[1].indexPatternId">
                  </td>
                  <td>
                    <st-select required object-type="field" analyzed-warning="true"
                               index-pattern-id="relation.indices[1].indexPatternId"
                               ng-model="relation.indices[1].path"/>
                  </td>
                  <td>
                    <input required class="form-control small-input" type="text" ng-model="relation.label"/>
                  </td>
                  <td>
                    <div class="btn-group rightCorner">
                      <array-param-remove index="{{ $index }}" model="relations.relationsIndices"></array-param-remove>
                    </div>
                  </td>
                </tr>
                <tr ng-if="!!relation.error">
                  <td colspan="7">
                    <h4 class="hintbox-heading">
                      <i class="fa fa-danger text-danger"></i> Definition error
                    </h4>
                    <p>{{relation.error}}</p>
                  </td>
                </tr>
              </tbody>
            </table>
            <array-param-add label="relation" model="relations.relationsIndices" default="{{ { indices: [ {}, {} ] } }}"></array-param-add>
          </div>
          <div class="form-group">
            <button class="btn btn-success" ng-click="submit('indices')" ng-disabled="indicesForm.$invalid || invalid">Save</button>
          </div>
        </form>
        <form name="dashboardsForm" ng-class="{ active: state.tab === 'dashboards' }" class="tab-pane" novalidate>
          <div class="form-group table-responsive">
            <table class="table table-condensed">
              <thead>
                <tr>
                  <th>Left Dashboard</th>
                  <th></th>
                  <th>Right Dashboard</th>
                  <th>Relation</th>
                  <th></th>
                </tr>
              </thead>
              <tbody ng-repeat="relation in relations.relationsDashboards">
                <tr class="relation-row" ng-class="{ 'red-border' : !!relation.error }">
                  <td>
                    <st-select required object-type="dashboard" ng-model="relation.dashboards[0]" id="$index" filter="filterDashboards"></st-select>
                  </td>
                  <td>
                    <i aria-hidden="true" class="fa fa-arrows-h"></i>
                  </td>
                  <td>
                    <st-select required object-type="dashboard" ng-model="relation.dashboards[1]" id="$index" filter="filterDashboards"></st-select>
                  </td>
                  <td>
                    <st-select required object-type="joinRelations" ng-model="relation.relation" id="$index" filter="filterRelations"></st-select>
                  </td>
                  <td>
                    <div class="btn-group rightCorner">
                      <array-param-remove index="{{ $index }}" model="relations.relationsDashboards"></array-param-remove>
                    </div>
                  </td>
                </tr>
                <tr ng-if="!!relation.error">
                  <td colspan="7">
                    <h4 class="hintbox-heading">
                      <i class="fa fa-danger text-danger"></i> Definition error
                    </h4>
                    <p>{{relation.error}}</p>
                  </td>
                </tr>
              </tbody>
            </table>
            <array-param-add label="relation" model="relations.relationsDashboards" default="{{ { dashboards: [ '', '' ] } }}"></array-param-add>
          </div>
          <div class="form-group">
            <button class="btn btn-success" ng-click="submit('dashboards')" ng-disabled="dashboardsForm.$invalid || invalid">Save</button>
          </div>
        </form>
      </div>
    </div>

    <div class="graph-section">
      <h2>Graph of Index Patterns</h2>
      <eeg graph="indicesGraph" class="eeg"></eeg>
      <h2 ng-if="state.tab === 'dashboards'">Graph of Dashboards</h2>
      <eeg ng-if="state.tab === 'dashboards'" graph="dashboardsGraph" class="eeg"></eeg>
    </div>

  </div>
</kbn-settings-app>
