[[shield-integration]]
== Shield Integration  [Enterprise Edition only]

=== Behaviours and warning display messages

Since the first version of _Kibi Enterprise plugin_, Shield is fully integrated
and supported, with all its functionality and features. _Kibi Enterprise plugin_
is also the only solution available to get the best possible integration between
Kibi and Shield, ensuring better customer experience through a dedicated
management of errors, specific for relationships between indices.
_Kibi Enterprise plugin_ lets you view the permission errors in a more humanly
understandable way and with the affordable option to disable each message
through the configuration of a specific parameter present in the advanced settings.
During navigation and in the presence of special restrictions on data visualization
inside indexes, you can meet the following errors:

* _"Kibi Relational Filter: Could not load filter Relational visualization: one
or more join relations refers to unauthorized data"_: You can see this message when
all relations available for a saved search are related to data which you do not
have permission to view.
* _"One or more visualizations Refers to unauthorized data"_: This message is visible
when inside the dashboard there are one or more views that require access to
unauthorized data.
* _"Enhanced search results: Refers to unauthorized data"_: This message is visible
when using a widget "Enhanced search results" which refers to unauthorized data.
* _"Kibi Relational Filter: there are relations with unauthorized data"_: This message
is visible when there are the relationships between unauthorized data.
* _"One or more saved search Refers to unauthorized data"_: This message is visible
when you have the saved search that refers to unauthorized data.

All these error messages appear for five seconds as yellow toaster at the top of
the screen. You can permanently hide these messages changing the
*kibi:shieldAuthorizationWarning* variable: move under the tab _Advanced_, in
_Settings_, and set to false the *kibi:shieldAuthorizationWarning* variable to hide
the error messages (default to _true_, so all authorization messages are shown).
Even if you set *kibi:shieldAuthorizationWarning* to _false_, all permission errors
are reported as warnings in the console.

._Two warning messages example_
image::images/authorization-warning-messages.png["Two warning messages example",align="center"]

All authorization errors are displayed as _"warning" messages_ in Kibi. There are
many different cases for all possible authorization configurations but, essentially,
Kibi with Shield reacts at only two possibilities: can or cannot see the index.
If we have a restriction permission on the index, we can see nothing of data inside
it so, for example, if we have a dashboard related to a saved search on an unauthorized
index, we should see only empty visualization (with all warning messages, we can
also see that query results counter in _Dashboard tab_ show the message *Unauthorized*).
Otherwise, if we have only some restricted documents or fields, we should see all
others data without any problem but, when we have a visualization that uses
unauthorized fields or documents, we can see only data that we can access (if the
visualizations is based only on unauthorized data, we should see an error message
inside the widget).

._Visualizations that use unauthorized data_
image::images/authorization-visualization-error.png["Visualization that use unauthorized data",align="left"]

._Visualizations that refer to an unauthorized index_
image::images/authorization-visualization-empty.png["Visualization that refer to an unauthorized index",align="left"]

=== Installation on Microsoft Windows
You'll need to have *Java JDK* installed on your computer (you can check your installation: usually, Java is under _C:\Program Files\Java\jdk1.8.0_92\bin_ but it might differ on your version of Windows).

After you completed your installation (download Java JDK from Oracle websites), go to _Start > Computer > System Properties > Advanced System Properties > Environmental Variables_ under _Advanced_ find the *"Path" variable* and paste this
----
C:\Program Files\Java\jdk1.8.0_92\bin
----
after the value that is already written, separating the two with *;* (_semicolon_)

You also need to configure *OpenSSL*:

. Install the OpenSSL from these binaries: http://slproweb.com/products/Win32OpenSSL.html
+
(for example, choose _Win64 OpenSSL v1.0.2g_ for a _64 bit OS_)

. Once installed, create the folder:
+
----
C:\Demo
----

. Start a command-line prompt (_cmd.exe_) and go to the demo folder typing:
+
----
cd \Demo
----

. Before starting *OpenSSL*, set 2 environment variables:
+
----
set RANDFILE=c:\Demo\.rnd && ^
set OPENSSL_CONF=C:\OpenSSL-Win64\bin\openssl.cfg
----

. Now you can start *OpenSSL*, typing:
+
----
C:\OpenSSL-Win64\bin\openssl.exe
----

==== Configuring Shield
. Create _server.{key,crt}_:
+
----
genrsa -out server.key 1024
req -new -x509 -days 366 -key server.key -out server.crt
----
. Then go to _distribution/elasticsearch_ and install plugin for Elasticsearch:
+
----
bin\plugin install license && ^
bin\plugin install shield
----
. Add the following line to the _distribution/elasticsearch/config/elasticsearch.yml_
+
----
shield.dls_fls.enabled: true
----
+
- Add these to _elasticsearch/config/shield/roles.yml_:
+
----
# Defines the required permissions for transport clients
transport_client:
  cluster:
      - cluster:monitor/nodes/liveness
      #uncomment the following for sniffing
      #- cluster:monitor/state
  indices:
    '*':
      privileges: indices:data/read/get, indices:data/read/mget, indices:data/read/search

# The required permissions for kibana 4 users.
# The required permissions for kibana 4 users.
kibana4:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
  indices:
    'article':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'company':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'investment':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'investor':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# The required permissions for the kibana 4 server
kibana4_server:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
      - cluster:monitor/state
      - cluster:monitor/nodes/stats
  indices:
    '*':
      privileges: indices:monitor/stats
    '.kibi':
      privileges: indices:admin/create, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# Role for grant access only to index "investment"
restrictedindex:
  indices:
    'investment':
      privileges: all
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# Role for restrict access to some fields of index "investment" (user can't see data referred to funded_date)
restrictedfieldsinvestment:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
      - cluster:admin/plugin/siren/license/get
  indices:
    'investment':
      privileges: all
      fields:
        - hassourcedescription
        - localname
        - investorid
        - hassourceurl
        - companyid
        - id
        - label
        - raised_amount
        - round_code
        - raised_currency_code
        - funded_date
        - funded_year
        - _source
        - _score
    'article':
      privileges: all
    'company':
      privileges: all
    'investor':
      privileges: all
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update
----

. In Elasticsearch root folder execute (the first two users are used by Kibi):
+
----
bin\shield\esusers useradd kibana4-server -r kibana4_server -p password && ^
bin\shield\esusers useradd transport_client -r transport_client -p password && ^
bin\shield\esusers useradd usernames -r kibana4 -p password && ^
bin\shield\esusers useradd usernames-index -r restrictedindex -p password && ^
bin\shield\esusers useradd usernames-fields -r restrictedfieldsinvestment -p password
----

. Go to _distribution/kibi_, download *Kibana Shield plugin* (http://download.elastic.co/kibana/shield/shield-2.2.0.tar.gz) into _Demo folder_:
+
----
bin\kibi plugin --install shield --url file://C:\Demo\shield-2.2.0.tar.gz
----
. Edit _config/kibi.yml_:
+
----
The server.key and server.crt files were generated above.
elasticsearch.username: "kibana4-server"
elasticsearch.password: "password"
shield.encryptionKey: "something_secret"
shield.sessionTimeout: 86400000
server.ssl.key: C:\Demo\server.key
server.ssl.cert: C:\Demo\server.crt
----
+
----
kibi_core:
  load_jdbc: false
  datasource_encryption_algorithm: 'AES-GCM'
  datasource_encryption_key: 'iSxvZRYisyUW33FreTBSyJJ34KpEquWznUPDvn+ka14='
  datasource_cache_size: 501
  default_dashboard_id: Articles
  elasticsearch:
    transport_client:
      username: transport_client
      password: password
  gremlin_server:
    url: https://127.0.0.1:8061
    path: ./gremlin_server/gremlin-es2-server-0.1.0.jar
    # uncomment this for gremlin behind ssl
    #ssl:
    # key_store: 'C:\Demo\ca\gremlin.jks'
    # key_store_password: 'password'
    # ca: 'C:\Demo\ca\certs\cacert.pem'
----

==== Configuring Gremlin Server
. Prepare the folders:
+
----
mkdir ca\private ca\certs ca\conf
cd ca
echo 01 > serial
type nul >> index.txt
type nul >> conf\caconfig.cnf
----

. Open the _conf\caconfig.cnf_ in a text editor and paste the following_
+
----
#..................................
[ ca ]
default_ca = CA_default
[ CA_default ]
copy_extensions = copy
dir = c:\\Demo\\ca
serial = $dir\\serial
database = $dir\\index.txt
new_certs_dir = $dir\\certs
certificate = $dir\\certs\\cacert.pem
private_key = $dir\\private\\cakey.pem
default_days = 712
default_md = sha256
preserve = no
email_in_dn = no
x509_extensions = v3_ca
name_opt = ca_default
cert_opt = ca_default
policy = policy_anything
[ policy_anything ]
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional
[ req ]
default_bits = 2048 # Size of keys
default_keyfile = key.pem # name of generated keys
default_md = sha256 # message digest algorithm
string_mask = nombstr # permitted characters
distinguished_name = req_distinguished_name
req_extensions = v3_req
[ req_distinguished_name ]
# Variable name Prompt string
#------------------------- ----------------------------------
0.organizationName = Organization Name (company)
organizationalUnitName = Organizational Unit Name (department, division)
emailAddress = Email Address
emailAddress_max = 40
localityName = Locality Name (city, district)
stateOrProvinceName = State or Province Name (full name)
countryName = Country Name (2 letter code)
countryName_min = 2
countryName_max = 2
commonName = Common Name (hostname, IP, or your name)
commonName_max = 64
# Default values for the above, for consistency and less typing.
# Variable name Value
#------------------------ ------------------------------
0.organizationName_default = Elasticsearch Test Org
localityName_default = Amsterdam
stateOrProvinceName_default = Amsterdam
countryName_default = NL
emailAddress_default = cacerttest@YOUR.COMPANY.TLD
[ v3_ca ]
basicConstraints = CA:TRUE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer:always
[ v3_req ]
basicConstraints = CA:FALSE
subjectKeyIdentifier = hash
----
*!! Edit the line DIR=\PATH\TO\YOUR\DIR\ca*

. Generate the cert:
+
----
c:\OpenSSL-Win64\bin\openssl.exe
----
+
----
req -new -x509 -extensions v3_ca -keyout private/cakey.pem -out certs/cacert.pem -days 366  -config conf/caconfig.cnf
----
+
----
exit
----
+
When asked to enter PEM pass phrase enter something (for example "password" but it should be more complicated)

. Create *Keystore*:
+
----
keytool -importcert -keystore gremlin.jks -file certs\cacert.pem -alias my_ca
----
+
----
Enter password: enter something (for example "password" but it should be more complicated)
----
+
----
Trust this certificate? [no]: type yes
----

. Generate all needed parts:
+
----
keytool -genkey  -alias gremlin01 -keystore gremlin.jks -keyalg RSA -keysize 2048 -validity 366 -ext san=ip:127.0.0.1
----
+
----
keytool -certreq -alias gremlin01 -keystore gremlin.jks -file gremlin.csr -keyalg rsa -ext san=ip:127.0.0.1
----
+
----
C:\OpenSSL-Win64\bin\openssl.exe
----
+
----
ca -in gremlin.csr -notext -out gremlin-signed.crt -config conf\caconfig.cnf -extensions v3_req
----
+
----
exit
----
+
----
keytool -importcert -keystore gremlin.jks -file gremlin-signed.crt -alias gremlin01
----

. Edit _kibi.yml_ to enable ssl between Gremlin and Kibi:
+
----
kibi_core:
  load_jdbc: true
  datasource_encryption_algorithm: 'AES-GCM'
  datasource_encryption_key: 'iSxvZRYisyUW33FreTBSyJJ34KpEquWznUPDvn+ka14='
  datasource_cache_size: 501
  default_dashboard_id: Articles
  elasticsearch:
    transport_client:
      username: transport_client
      password: password
  gremlin_server:
    url: https://127.0.0.1:8061
    path: ../gremlin_server/gremlin-es2-server-0.1.0.jar
    # uncomment this for gremlin behind ssl
    ssl:
     key_store: 'c:\Demo\ca\gremlin.jks'
     key_store_password: 'password'
     ca: 'c:\Demo\ca\certs\cacert.pem'
----

=== Installation on UNIX
==== Configuring Shield
Install *Shield* and *license* plugin for Elasticsearch:
https://www.elastic.co/guide/en/shield/current/getting-started.html
----
bin/plugin install license
bin/plugin install shield
----
* Follow https://www.elastic.co/guide/en/shield/current/kibana.html to install the Shield plugin for Kibi
- SSL in points (4 is not required for development) and (5) are not the same
- Kibana does not support SSL with a passphrase

Create _server.{key,crt}_ using http://blog.justin.kelly.org.au/how-to-create-a-self-sign-ssl-cert-with-no-pa/
----
openssl genrsa -out server.key 1024
openssl req -new -key server.key -out server.csr
openssl x509 -req -days 366 -in server.csr -signkey server.key -out server.crt
----

*In Elasticsearch root folder execute (the first two users are used by Kibi):*

Add my own user with _kibana4 role_ and _kibana4-server user_ with _kibana4-server role_:
----
./bin/shield/esusers useradd kibana4-server -r kibana4_server -p password
./bin/shield/esusers useradd transport_client -r transport_client -p password

./bin/shield/esusers useradd usernames -r kibana4 -p password
./bin/shield/esusers useradd usernames-index -r restrictedindex -p password
./bin/shield/esusers useradd usernames-fields -r restrictedfieldsinvestment -p password
----

To enable field and doc restriction for version 2.2.0 add this flag to _elasticsearch.yml_:
----
shield.dls_fls.enabled: true
----
it was fixed in 2.2.1

*Elasticsearch roles*

Edit _config/shield/roles.yml_. I added some authorization for various actions performed in Kibi (listing plugins, getting stats, ...);
----
# Defines the required permissions for transport clients
transport_client:
  cluster:
      - cluster:monitor/nodes/liveness
      #uncomment the following for sniffing
      #- cluster:monitor/state
  indices:
    '*':
      privileges: indices:data/read/get, indices:data/read/mget, indices:data/read/search

# The required permissions for kibana 4 users.
# The required permissions for kibana 4 users.
kibana4:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
  indices:
    'article':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'company':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'investment':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    'investor':
      privileges: indices:data/read/get, indices:admin/mappings/fields/get, indices:admin/validate/query, indices:data/read/search, indices:data/read/msearch, indices:data/read/field_stats, indices:admin/get, indices:data/read/coordinate-search, indices:data/read/coordinate-msearch
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# The required permissions for the kibana 4 server
kibana4_server:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
      - cluster:monitor/state
      - cluster:monitor/nodes/stats
  indices:
    '*':
      privileges: indices:monitor/stats
    '.kibi':
      privileges: indices:admin/create, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# Role for grant access only to index "investment"
restrictedindex:
  indices:
    'investment':
      privileges: all
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update

# Role for restrict access to some fields of index "investment" (user can't see data referred to funded_date)
restrictedfieldsinvestment:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
      - cluster:admin/plugin/siren/license/get
  indices:
    'investment':
      privileges: all
      fields:
        - hassourcedescription
        - localname
        - investorid
        - hassourceurl
        - companyid
        - id
        - label
        - raised_amount
        - round_code
        - raised_currency_code
        - funded_date
        - funded_year
        - _source
        - _score
    'article':
      privileges: all
    'company':
      privileges: all
    'investor':
      privileges: all
    '.kibi':
      privileges: indices:data/read/coordinate-search, indices:admin/exists, indices:admin/mapping/put, indices:admin/mappings/fields/get, indices:admin/refresh, indices:admin/validate/query, indices:data/read/get, indices:data/read/mget, indices:data/read/search, indices:data/write/delete, indices:data/write/index, indices:data/write/update
----
*Install Shield for Kibana !!! It has to be version 2.2.0 at the moment*
----
wget http://download.elastic.co/kibana/shield/shield-2.2.0.tar.gz
./bin/kibi plugin --install shield --url file://$PWD/shield-2.2.0.tar.gz
----

*Modify kibi.yml*

Edit _config/kibi.yml_:
----
elasticsearch.username: "kibana4-server"
elasticsearch.password: "password"
shield.encryptionKey: "something_secret"
shield.sessionTimeout: 86400000
server.ssl.key: server.key
server.ssl.cert: server.crt
----
The _server.key_ and _server.crt_ files were generated above.

Then in the *kibi core* we need:
----
kibi_core:
  load_jdbc: true
  datasource_encryption_algorithm: 'AES-GCM'
  datasource_encryption_key: 'iSxvZRYisyUW33FreTBSyJJ34KpEquWznUPDvn+ka14='
  datasource_cache_size: 501
  default_dashboard_id: Articles
  elasticsearch:
    transport_client:
      username: transport_client
      password: password
  gremlin_server:
    url: https://127.0.0.1:8061
    path: ../gremlin_server/gremlin-es2-server-0.1.0.jar
    # uncomment this for gremlin behind ssl
    #ssl:
    # key_store: '/opt/kibi/ca/gremlin.jks'
    # key_store_password: 'password'
    # ca: '/opt/kibi/certs/cacert.pem'
----

==== Configuring Gremlin Server
----
mkdir -p ca/private ca/certs ca/conf
cd ca
echo '01' > serial && touch index.txt
vim conf/caconfig.cnf
----
Paste below into _conf/caconfig.cnf_:
----
#..................................
[ ca ]
default_ca = CA_default
[ CA_default ]
copy_extensions = copy
dir = /opt/kibi/ca
serial = $dir/serial
database = $dir/index.txt
new_certs_dir = $dir/certs
certificate = $dir/certs/cacert.pem
private_key = $dir/private/cakey.pem
default_days = 712
default_md = sha256
preserve = no
email_in_dn = no
x509_extensions = v3_ca
name_opt = ca_default
cert_opt = ca_default
policy = policy_anything
[ policy_anything ]
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional
[ req ]
default_bits = 2048 # Size of keys
default_keyfile = key.pem # name of generated keys
default_md = sha256 # message digest algorithm
string_mask = nombstr # permitted characters
distinguished_name = req_distinguished_name
req_extensions = v3_req
[ req_distinguished_name ]
# Variable name Prompt string
#------------------------- ----------------------------------
0.organizationName = Organization Name (company)
organizationalUnitName = Organizational Unit Name (department, division)
emailAddress = Email Address
emailAddress_max = 40
localityName = Locality Name (city, district)
stateOrProvinceName = State or Province Name (full name)
countryName = Country Name (2 letter code)
countryName_min = 2
countryName_max = 2
commonName = Common Name (hostname, IP, or your name)
commonName_max = 64
# Default values for the above, for consistency and less typing.
# Variable name Value
#------------------------ ------------------------------
0.organizationName_default = Elasticsearch Test Org
localityName_default = Amsterdam
stateOrProvinceName_default = Amsterdam
countryName_default = NL
emailAddress_default = cacerttest@YOUR.COMPANY.TLD
[ v3_ca ]
basicConstraints = CA:TRUE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer:always
[ v3_req ]
basicConstraints = CA:FALSE
subjectKeyIdentifier = hash
----
*!! Edit the line dir = /PATH/TO/YOUR/DIR/ca*

*Generate the cert*
----
openssl req -new -x509 -extensions v3_ca -keyout private/cakey.pem -out certs/cacert.pem -days 366  -config conf/caconfig.cnf
----
When asked to enter PEM pass phrase enter something (I've entered "password" - however something more complicated is recomended)

*Create Keystore*
----
keytool -importcert -keystore gremlin.jks -file certs/cacert.pem -alias my_ca
----
Enter password: enter something (I've entered "password" - however something more complicated is recomended)

Trust this certificate? [no]: yes Certificate was added to keystore

*Generate all needed parts*
----
keytool -genkey  -alias gremlin01 -keystore gremlin.jks -keyalg RSA -keysize 2048 -validity 366 -ext san=ip:127.0.0.1
keytool -certreq -alias gremlin01 -keystore gremlin.jks -file gremlin.csr -keyalg rsa -ext san=ip:127.0.0.1

openssl ca -in gremlin.csr -notext -out gremlin-signed.crt -config conf/caconfig.cnf -extensions v3_req
keytool -importcert -keystore gremlin.jks -file gremlin-signed.crt -alias gremlin01
----

*"kibi.yml" should look like*
----
kibi_core:
  load_jdbc: true
  datasource_encryption_algorithm: 'AES-GCM'
  datasource_encryption_key: 'iSxvZRYisyUW33FreTBSyJJ34KpEquWznUPDvn+ka14='
  datasource_cache_size: 501
  default_dashboard_id: Articles
  elasticsearch:
    transport_client:
      username: transport_client
      password: password
  gremlin_server:
    url: https://127.0.0.1:8061
    path: ../gremlin_server/gremlin-es2-server-0.1.0.jar
    # uncomment this for gremlin behind ssl
    ssl:
     key_store: '/opt/kibi/ca/gremlin.jks'
     key_store_password: 'password'
     ca: '/opt/kibi/ca/certs/cacert.pem'
----
